{% extends "base.html" %}
{% load static %}

{% block title %}My Cart{% endblock %}

{% block content %}
<div class="container my-5">
  <h3>Your Basket</h3>
  <p class="text-success">Delivery in ⚡ 9 mins</p>

  <!-- Cart Table -->
  <div class="table-responsive">
    <table class="table align-middle">
      <thead class="table-light">
        <tr>
          <th>Items</th>
          <th style="width:150px">Quantity</th>
          <th style="width:120px">Sub-total</th>
        </tr>
      </thead>
      <tbody id="cart-items-body">
        {% for item in cart.items.all %}
        <tr data-item-id="{{ item.id }}">
          <td>
            <div class="d-flex align-items-center">
              <img src="{{ item.product.image.url }}" width="70" class="me-3 rounded border" alt="{{ item.product.title }}">
              <div>
                <div><strong>{{ item.product.title }}</strong></div>
                <div class="text-muted small">
                  ₹{{ item.price_snapshot }}
                  {% if item.product.old_price %}
                    <del class="ms-1">₹{{ item.product.old_price }}</del>
                  {% endif %}
                </div>
                <div class="text-muted small mt-1">
                  <a href="#" class="text-danger remove-btn" data-id="{{ item.id }}">Delete</a> |
                  <a href="#" class="text-secondary save-btn" data-id="{{ item.id }}">Save for later</a>
                </div>
              </div>
            </div>
          </td>

          <td>
            <div class="input-group input-group-sm" style="width:140px">
              <button class="btn btn-outline-secondary minus-btn" data-id="{{ item.id }}">-</button>
              <input type="text" class="form-control text-center qty-input" value="{{ item.quantity }}" readonly>
              <button class="btn btn-outline-secondary plus-btn" data-id="{{ item.id }}">+</button>
            </div>
          </td>

          <td class="item-subtotal">₹{{ item.line_total }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="3" class="text-muted">Your cart is empty.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Saved For Later -->
  <h5 class="mt-4">Saved For Later</h5>
  <div id="saved-items" class="row g-3">
    <!-- JS will render saved items here -->
  </div>
</div>

<!-- Bottom fixed bar -->
<div class="fixed-bottom bg-white border-top py-3">
  <div class="container d-flex justify-content-between align-items-center">
    <div>
      <div>Subtotal: ₹<span id="cart-subtotal">{{ cart_total }}</span></div>
      <div class="text-success small">Savings: ₹<span id="cart-savings">{{ cart_savings }}</span></div>
    </div>

    <div class="d-flex gap-2">
      <button class="btn btn-outline-secondary">Get it now<br><small>7 mins</small></button>
      <button class="btn btn-outline-secondary">Schedule<br><small>Later</small></button>
      <a href="/checkout/" class="btn btn-danger btn-lg">Proceed to Checkout</a>
    </div>
  </div>
</div>


{% endblock %}

{% block extra_js %}
<script src="{% static 'js/cart.js' %}"></script>
{% endblock %}
