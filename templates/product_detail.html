{% extends "base.html" %}
{% load static %}

{% block title %}{{ product.title }}{% endblock %}

{% block content %}
<div class="container my-5">
  <div class="row g-4">
    <!-- LEFT: Images -->
    <div class="col-md-6 d-flex">
      <!-- Thumbnails -->
      <div class="d-flex flex-column me-3" style="width:100px;">
        {% if product.images.all %}
          {% for img in product.images.all %}
            <img src="{{ img.images.url }}" 
                 data-src="{{ img.images.url }}"
                 class="thumb border mb-2" 
                 style="width:100px; height:100px; object-fit:cover; cursor:pointer;">
          {% endfor %}
        {% else %}
          <img src="{{ product.image.url }}" 
               data-src="{{ product.image.url }}"
               class="thumb border mb-2" 
               style="width:100px; height:100px; object-fit:cover; cursor:pointer;">
        {% endif %}
      </div>

      <!-- Main image + Zoom -->
      <div class="flex-grow-1 text-center border position-relative"
           style="width:500px; height:400px; display:flex; align-items:center; justify-content:center;">
        <img id="main-image" src="{{ product.image.url }}" 
             alt="{{ product.title }}" 
             style="width:100%; height:100%; object-fit:contain; cursor:crosshair;">

        <div id="zoom-result" 
             class="position-absolute border bg-white d-none" 
             style="top:0; right:-520px; width:400px; height:400px; overflow:hidden; z-index:10;">
          <img id="zoomed-image" src="{{ product.image.url }}" 
               style="position:absolute; width:800px; height:auto;">
        </div>
      </div>
    </div>

    <!-- RIGHT: Product info -->
    <div class="col-md-6">
      <h6 class="text-muted">{{ product.brand|default:"fresho!" }}</h6>
      <h3 class="fw-bold">{{ product.title }}</h3>

      <!-- Price -->
      <div class="mb-2 d-flex align-items-center gap-3">
        <span class="fs-4 fw-bold text-success">₹{{ product.price }}</span>
        {% if product.old_price %}
          <del class="text-muted">₹{{ product.old_price }}</del>
          <span class="badge bg-danger">
            -{{ product.discount|default:"0" }}%
          </span>
        {% endif %}
      </div>

      <button class="btn btn-light border mb-3">Har Din Sasta! <span class="float-end">▾</span></button>

      <!-- Pack Sizes -->
      <h6>Pack Sizes</h6>
      <div class="list-group mb-3">
        <label class="list-group-item d-flex justify-content-between align-items-center">
          <span>500 g</span>
          <span>₹{{ product.price }}</span>
          <span class="badge bg-warning">⚡ 9 MINS</span>
        </label>
        <label class="list-group-item d-flex justify-content-between align-items-center">
          <span>1 kg</span>
          <span>₹{{ product.price }}</span>
          <span class="badge bg-warning">⚡ 9 MINS</span>
        </label>
      </div>

      <!-- Buttons -->
      <div class="d-flex gap-2">
        <button class="btn btn-danger btn-lg flex-grow-1" id="add-to-cart-btn" data-id="{{ product.id }}">
          Add to basket
        </button>
        <button class="btn btn-outline-secondary btn-lg">Save for later</button>
      </div>
    </div>
  </div>

  <!-- Description -->
  <div class="mt-5 p-4 border rounded bg-light">
    <h5>Product Details</h5>
    <p>{{ product.description|default:"No description available for this product." }}</p>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/product_detail.js' %}"></script>
{% endblock %}
